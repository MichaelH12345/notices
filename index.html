<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image and Text Box Example</title>
    <style>
        /* Load custom font from GitHub */
        @font-face {
            font-family: 'NetworkRailSans';
            src: url('https://raw.githubusercontent.com/MichaelH12345/notices/main/network_rail_sans-webfont%20(1).ttf') format('truetype');
        }

        /* Style for links (set to white and disable interaction) */
        a {
            color: white;  /* Set the link color to white */
            text-decoration: none;  /* Remove underline */
            pointer-events: none;  /* Disable clicking */
            cursor: default;  /* Change the cursor to default (non-clickable) */
        }

        /* Style for the text box */
        .text-box {
            width: 540px;
            left: 20px;
            color: white;
            padding: 20px;
            margin-top: 120px;
            font-family: 'NetworkRailSans', Arial, sans-serif; /* Apply custom font */
            font-size: 40px;
            text-align: left; /* Center the text */
            position: relative;
            z-index: 2; /* Make sure the text box is on top */
            
        }

        /* Style for the image with fixed size */
        .image {
            position: absolute;
            top: 0;
            left: 0;
            width: 638px;  /* Set the image width to 638px */
            height: 929px; /* Set the image height to 929px */
            z-index: 1; /* Set the image behind the text */
        }

        /* Style for the page counter */
        .page-counter {
            color: white;
            font-family: 'NetworkRailSans', Arial, sans-serif;
            font-size: 35px;
            position: absolute;
            top: 840px;
            left: 45px;
            z-index: 3;
        }
    </style>
</head>
<body>
    <!-- Image placed at the top-left corner with fixed size -->
    <img src="https://github.com/MichaelH12345/notices/blob/main/Information%20(2).png?raw=true" alt="Information Image" class="image">

    <!-- Text box to display message -->
    <div class="text-box" id="message-box">
        <!-- Message will be injected here by JavaScript -->
    </div>

    <!-- Page counter -->
    <div class="page-counter" id="page-counter">Page 1 of 1</div>

    <script>
        let currentPage = 1;
        let totalPages = 1;
        let messages = [];

        // Fetch the data from the API
        fetch('https://national-rail-api.davwheat.dev/staffdepartures/CAR?expand=true')
            .then(response => response.json())
            .then(data => {
                // Check if there are nrccMessages and if there are xhtmlMessages
                const nrccMessages = data.nrccMessages;
                if (nrccMessages && nrccMessages.length > 0) {
                    // Process and clean each message
                    messages = nrccMessages.map(message => processMessage(message.xhtmlMessage));
                    totalPages = messages.length;
                    updateMessage();
                } else {
                    document.getElementById('message-box').innerHTML = 'No messages available.';
                }

                // Update page counter initially
                updatePageCounter();

                // Cycle through messages every 10 seconds
                setInterval(() => {
                    currentPage = (currentPage % totalPages) + 1; // Loop back to the first page after the last one
                    updateMessage();
                    updatePageCounter();
                }, 10000); // 10 seconds
            })
            .catch(error => {
                console.error('Error fetching data:', error);
                document.getElementById('message-box').innerHTML = 'Failed to load messages.';
            });

        // Function to process and clean the message content
        function processMessage(message) {
            // Get the first 5 characters
            let firstFiveChars = message.slice(0, 5);

            // Remove <p> and </p> tags from the first 5 characters only
            firstFiveChars = firstFiveChars.replace(/<p>/g, '').replace(/<\/p>/g, '');

            // Get the rest of the message (starting from the 6th character onwards)
            let remainingMessage = message.slice(5);

            // Reassemble the cleaned message
            let cleanedMessage = firstFiveChars + remainingMessage;

            // Remove newline characters
            cleanedMessage = cleanedMessage.replace(/\n/g, '');

            // Remove Unicode escape sequences
            cleanedMessage = cleanedMessage.replace(/\\u[0-9a-fA-F]{4}/g, '');

            // Replace certain phrases
            cleanedMessage = cleanedMessage.replace(/(More details|More information|Latest).*/i, 'More details at nationalrail.co.uk.');

            // Add line breaks after colons
            cleanedMessage = cleanedMessage.replace(/:/g, ':<br>');

            return cleanedMessage;
        }

        // Function to update the message box
        function updateMessage() {
            if (messages.length > 0) {
                document.getElementById('message-box').innerHTML = messages[currentPage - 1];
            }
        }

        // Function to update the page counter
        function updatePageCounter() {
            document.getElementById('page-counter').textContent = `Page ${currentPage} of ${totalPages}`;
        }
    </script>
</body>
</html>
